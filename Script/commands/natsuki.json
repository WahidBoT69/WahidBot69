module.exports.config = {
  name: "natsuki",
  version: "1.0.1",
  hasPermssion: 2,
  credits: "ğ‚ğ˜ğğ„ğ‘ â˜¢ï¸_ğ–£˜ -ğğğ“ âš ï¸ ğ‘»ğ‘¬ğ‘¨ğ‘´_ â˜¢ï¸",
  description: "Táº¡o ra má»™t avt trÃªn taoanhdep.",
  commandCategory: "táº¡o áº£nh",
  cooldowns: 0,
  dependencies: {
      "fs-extra": "",
      "request": "",
      "axios": "",
      "node-fetch": ""
        }
};

module.exports.run = async function ({ api, args, event}) {
  const fs = global.nodemodule["fs-extra"];
const axios = global.nodemodule["axios"];
const fetch = global.nodemodule["node-fetch"];
const streamBuffers = require("stream-buffers");

module.exports.config = {
  name: "natsuki",
  version: "1.0.1",
  hasPermssion: 0,
  credits: "ğ‚ğ˜ğğ„ğ‘ â˜¢ï¸_ğ–£˜ -ğğğ“ âš ï¸ ğ‘»ğ‘¬ğ‘¨ğ‘´_ â˜¢ï¸ (Modified by ChatGPT)",
  description: "DDLC Natsuki à¦•à§à¦¯à¦¾à¦°à§‡à¦•à§à¦Ÿà¦¾à¦° à¦¦à¦¿à§Ÿà§‡ anime-style avt à¦¤à§ˆà¦°à¦¿",
  commandCategory: "táº¡o áº£nh",
  usages: "[text]",
  cooldowns: 2,
  dependencies: {
    "fs-extra": "",
    "axios": "",
    "node-fetch": "",
    "stream-buffers": ""
  }
};

module.exports.run = async function ({ api, event, args }) {
  const text = args.join(" ");
  if (!text) return api.sendMessage("âš ï¸ à¦¦à§Ÿà¦¾ à¦•à¦°à§‡ à¦•à¦¿à¦›à§ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦¦à¦¾à¦“!\n\nà¦‰à¦¦à¦¾à¦¹à¦°à¦£:\n/natsuki à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à§Ÿ à¦ªà¦›à¦¨à§à¦¦ à¦•à¦°à¦¿", event.threadID, event.messageID);

  const background = ["bedroom", "class", "closet", "club", "corridor", "house", "kitchen", "residential", "sayori_bedroom"];
  const body = ["1b", "1", "2b", "2"];
  const face = [
    "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r",
    "s", "t", "u", "v", "w", "x", "y", "z", "1t", "2bt", "2bta", "2btb", "2btc", "2btd", "2bte",
    "2btf", "2btg", "2bth", "2bti", "2t", "2ta", "2tb", "2tc", "2td", "2te", "2tf", "2tg", "2th", "2ti"
  ];

  const url = `https://nekobot.xyz/api/imagegen?type=ddlc&character=natsuki&background=${random(background)}&body=${random(body)}&face=${random(face)}&text=${encodeURIComponent(text)}`;

  try {
    const res = await fetch(url);
    const json = await res.json();

    if (json.success) {
      const imgRes = await fetch(json.message);
      const imgBuffer = await imgRes.buffer();

      const imgStream = new streamBuffers.ReadableStreamBuffer({
        frequency: 10,
        chunkSize: 20480
      });

      imgStream.put(imgBuffer);
      imgStream.stop();
      imgStream.path = "natsuki.png";

      return api.sendMessage({
        body: "ğŸ–¼ï¸ à¦¤à§‹à¦®à¦¾à¦° Natsuki à¦›à¦¬à¦¿à¦Ÿà¦¿ à¦°à§‡à¦¡à¦¿!",
        attachment: imgStream
      }, event.threadID, event.messageID);
    } else {
      return api.sendMessage("âŒ à¦›à¦¬à¦¿ à¦¤à§ˆà¦°à¦¿ à¦¬à§à¦¯à¦°à§à¦¥ à¦¹à§Ÿà§‡à¦›à§‡! à¦ªà¦°à§‡ à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§‹à¥¤", event.threadID, event.messageID);
    }
  } catch (err) {
    console.error(err);
    return api.sendMessage("âš ï¸ à¦…à¦ªà§à¦°à¦¤à§à¦¯à¦¾à¦¶à¦¿à¦¤ à¦¤à§à¦°à§à¦Ÿà¦¿ à¦˜à¦Ÿà§‡à¦›à§‡à¥¤", event.threadID, event.messageID);
  }
};

function random(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}
